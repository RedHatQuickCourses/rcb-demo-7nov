<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Setting up an Ansible Control Node and Managed Hosts :: Introduction to Ansible</title>
    <link rel="prev" href="hands-on-lab.html">
    <link rel="next" href="executing-ad-hoc-commands-on-remote-hosts.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Introduction to Ansible</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rcb-demo-7nov" data-version="1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Introduction to Ansible</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ansible-basics/ansible-basics.html">Ansible Basics</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ansible-basics/what-is-ansible.html">What is Ansible?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ansible-basics/ansible-architecture-and-components.html">Ansible Architecture and Components</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="hands-on-lab.html">Hands-on Lab</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="setting-up-an-ansible-control-node-and-managed-hosts.html">Setting up an Ansible Control Node and Managed Hosts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="executing-ad-hoc-commands-on-remote-hosts.html">Executing Ad-hoc Commands on Remote Hosts</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../appendix/appendix.html">Appendix</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Introduction to Ansible</span>
    <span class="version">1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Introduction to Ansible</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Introduction to Ansible</a></li>
    <li><a href="hands-on-lab.html">Hands-on Lab</a></li>
    <li><a href="setting-up-an-ansible-control-node-and-managed-hosts.html">Setting up an Ansible Control Node and Managed Hosts</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Setting up an Ansible Control Node and Managed Hosts</h1>
<h1 id="setting-up-ansible-nodes" class="sect0"><a class="anchor" href="#setting-up-ansible-nodes"></a>Setting Up an Ansible Control Node and Managed Hosts</h1>
<div class="paragraph">
<p>This section guides you through the process of setting up your fundamental Ansible environment. This includes configuring an <strong>Ansible Control Node</strong> (where Ansible runs) and one or more <strong>Managed Hosts</strong> (the machines Ansible automates). This foundational setup is crucial for any automation tasks you&#8217;ll perform with Ansible.</p>
</div>
<div class="sect1">
<h2 id="what-are-control-and-managed-nodes"><a class="anchor" href="#what-are-control-and-managed-nodes"></a>Understanding Control Nodes and Managed Hosts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before we dive into the practical setup, let&#8217;s clearly define these core components in the Ansible ecosystem:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Control Node (or Management Host)</strong>:</p>
</li>
<li>
<p>This is the machine where Ansible is installed.</p>
</li>
<li>
<p>You execute all Ansible commands, playbooks, and scripts from this machine.</p>
</li>
<li>
<p>It acts as the central point for managing your infrastructure.</p>
</li>
<li>
<p>The Control Node initiates connections and pushes configurations to Managed Hosts.</p>
</li>
<li>
<p><strong>Managed Host (or Target Host)</strong>:</p>
</li>
<li>
<p>These are the servers, network devices, or cloud instances that Ansible manages and configures.</p>
</li>
<li>
<p>Crucially, Managed Hosts do <strong>not</strong> require Ansible software to be installed on them.</p>
</li>
<li>
<p>They only need a standard operating system, an SSH server (for Linux/Unix), and typically Python (for executing Ansible modules). For Windows hosts, WinRM (Windows Remote Management) is used instead of SSH.</p>
</li>
</ul>
</div>
<div class="imageblock text-center unresolved">
<div class="content">
<img src="ansible-control-node-managed-hosts.png" alt="Ansible Control Node and Managed Hosts Interaction">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites"><a class="anchor" href="#prerequisites"></a>Prerequisites for Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To successfully follow the hands-on lab and set up your environment, ensure you have the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Two Virtual Machines (VMs) or Cloud Instances</strong>:</p>
</li>
<li>
<p>One VM will serve as your <strong>Control Node</strong>.</p>
</li>
<li>
<p>One VM will serve as your <strong>Managed Host</strong>.</p>
</li>
<li>
<p>Both VMs should be running a recent Linux distribution (e.g., Ubuntu Server 22.04 LTS, CentOS Stream 9).</p>
</li>
<li>
<p>Record their IP addresses for later use.</p>
</li>
<li>
<p><strong><code>sudo</code> Privileges</strong>: You need a user account with <code>sudo</code> privileges on both the Control Node and Managed Hosts.</p>
</li>
<li>
<p><strong>Internet Connectivity</strong>: Both nodes require internet access to download necessary packages.</p>
</li>
<li>
<p><strong>Basic Linux Command Line Knowledge</strong>: Familiarity with navigating the file system, editing files, and executing commands in a Linux terminal.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="control-node-setup"><a class="anchor" href="#control-node-setup"></a>Setting Up the Ansible Control Node</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Control Node is where Ansible is installed and configured to orchestrate your automation tasks.</p>
</div>
<div class="sect2">
<h3 id="_step_1_install_ansible_on_the_control_node"><a class="anchor" href="#_step_1_install_ansible_on_the_control_node"></a>Step 1: Install Ansible on the Control Node</h3>
<div class="paragraph">
<p>Ansible can be installed using various methods. For most Linux distributions, the system&#8217;s package manager or <code>pip</code> (Python&#8217;s package installer) are the most common approaches. We&#8217;ll focus on package managers for simplicity, highlighting Ubuntu/Debian and CentOS/RHEL.</p>
</div>
<div class="sect3">
<h4 id="_using_system_package_manager_recommended_for_beginners"><a class="anchor" href="#_using_system_package_manager_recommended_for_beginners"></a>Using System Package Manager (Recommended for beginners)</h4>
<div class="paragraph">
<p>This method typically installs a stable, well-tested version of Ansible that integrates well with your system.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>On Ubuntu/Debian-based systems</strong> (e.g., Ubuntu, Debian, Linux Mint):
The recommended way to install the latest stable version of Ansible is via its official PPA (Personal Package Archive).
<code><code>bash
$ sudo apt update
$ sudo apt install software-properties-common -y
$ sudo add-apt-repository --yes --update ppa:ansible/ansible
$ sudo apt install ansible -y
</code></code>
Alternatively, for a quick install (which might install an older version from the default repositories):
<code><code>bash
$ sudo apt update
$ sudo apt install ansible -y
</code></code></p>
</li>
<li>
<p><strong>On CentOS/RHEL/Fedora-based systems</strong> (e.g., CentOS Stream, Rocky Linux, AlmaLinux, Fedora):
For CentOS/RHEL, Ansible is available from the EPEL (Extra Packages for Enterprise Linux) repository. For Fedora, it&#8217;s usually in the default repositories.
```bash
# For Fedora 30+
$ sudo dnf install ansible -y</p>
<div class="literalblock">
<div class="content">
<pre># For CentOS/RHEL 7, 8, 9 (requires EPEL repository)
$ sudo yum install epel-release -y # Install EPEL repository first
$ sudo yum install ansible -y
```</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_using_pip_python_package_installer"><a class="anchor" href="#_using_pip_python_package_installer"></a>Using <code>pip</code> (Python Package Installer)</h4>
<div class="paragraph">
<p>This method ensures you get the absolute latest version of Ansible. It&#8217;s often preferred for developers or when specific Ansible versions are required.</p>
</div>
<div class="paragraph">
<p>First, ensure Python 3 and <code>pip</code> are installed on your system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># On Ubuntu/Debian
$ sudo apt update &amp;&amp; sudo apt install python3 python3-pip -y

# On CentOS/RHEL/Fedora
$ sudo yum install python3 python3-pip -y # or dnf for Fedora</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, install Ansible using <code>pip</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ pip3 install --user ansible</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you used <code>pip</code>, you might need to add <code>~/.local/bin</code> to your <code>PATH</code> environment variable so your shell can find the <code>ansible</code> command. Add the following line to your <code>~/.bashrc</code> (or <code>~/.zshrc</code>) file and then <code>source</code> it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ echo 'export PATH="$HOME/.local/bin:$PATH"' &gt;&gt; ~/.bashrc
$ source ~/.bashrc</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_verify_ansible_installation"><a class="anchor" href="#_step_2_verify_ansible_installation"></a>Step 2: Verify Ansible Installation</h3>
<div class="paragraph">
<p>After installation, it&#8217;s crucial to verify that Ansible is installed correctly and check its version.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ansible --version</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see output similar to this, indicating the Ansible version, Python location, and configuration details:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">ansible [core 2.15.x]
  config file = /etc/ansible/ansible.cfg
  configured module search path = ['/home/user/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']
  ansible python location = /usr/bin/python3
  ansible collection location = /home/user/.ansible/collections:/usr/share/ansible/collections
  [...]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="managed-host-setup"><a class="anchor" href="#managed-host-setup"></a>Preparing the Managed Host(s)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Preparing Managed Hosts is generally simpler as they do not require Ansible itself to be installed. They primarily need an SSH server and a Python interpreter.</p>
</div>
<div class="sect2">
<h3 id="_step_1_ensure_ssh_server_is_installed_and_running"><a class="anchor" href="#_step_1_ensure_ssh_server_is_installed_and_running"></a>Step 1: Ensure SSH Server is Installed and Running</h3>
<div class="paragraph">
<p>Ansible communicates with Linux Managed Hosts over SSH. Most Linux distributions come with <code>openssh-server</code> pre-installed or readily available.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>On Ubuntu/Debian-based systems</strong>:
<code><code>bash
$ sudo apt update
$ sudo apt install openssh-server -y
$ sudo systemctl enable --now ssh # Ensure it starts on boot and is currently running
</code></code></p>
</li>
<li>
<p><strong>On CentOS/RHEL/Fedora-based systems</strong>:
<code><code>bash
$ sudo yum install openssh-server -y # or dnf for Fedora
$ sudo systemctl enable --now sshd # Ensure it starts on boot and is currently running
# If your firewall is active (e.g., firewalld), allow SSH traffic:
$ sudo firewall-cmd --permanent --add-service=ssh
$ sudo firewall-cmd --reload
</code></code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_ensure_python_is_installed"><a class="anchor" href="#_step_2_ensure_python_is_installed"></a>Step 2: Ensure Python is Installed</h3>
<div class="paragraph">
<p>Ansible modules, which are the actual code executed on managed hosts to perform tasks, are primarily written in Python. Ansible will automatically attempt to locate a suitable Python interpreter (preferably Python 3) on the managed host.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>On most modern Linux systems, Python 3 is already present.</strong> If not, you can install it:
<code><code>bash
$ sudo apt update &amp;&amp; sudo apt install python3 -y # Ubuntu/Debian
$ sudo yum install python3 -y # CentOS/RHEL/Fedora
</code></code>
<a href="#ansible-inventory.adoc#ansible-python-interpreter" class="xref unresolved">Later, you can explicitly tell Ansible which Python interpreter to use in your inventory file.</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ssh-key-based-authentication"><a class="anchor" href="#ssh-key-based-authentication"></a>Setting Up SSH Key-Based Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For secure and passwordless communication, Ansible heavily relies on SSH key-based authentication. This mechanism allows the Control Node to connect to Managed Hosts without requiring a password each time, which is essential for automation.</p>
</div>
<div class="sect2">
<h3 id="_step_1_generate_ssh_key_pair_on_the_control_node"><a class="anchor" href="#_step_1_generate_ssh_key_pair_on_the_control_node"></a>Step 1: Generate SSH Key Pair on the Control Node</h3>
<div class="paragraph">
<p>If you don&#8217;t already have an SSH key pair (typically <code>id_rsa</code> for the private key and <code>id_rsa.pub</code> for the public key) on your Control Node, generate one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ssh-keygen -t rsa -b 4096</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>When prompted for the file in which to save the key, press <code>Enter</code> to accept the default location (<code>~/.ssh/id_rsa</code>).</p>
</li>
<li>
<p>You&#8217;ll then be asked for a passphrase. For automation scripts, it&#8217;s common to leave this blank (press <code>Enter</code> twice) to enable passwordless access. However, for higher security, setting a strong passphrase is recommended, which would then require <code>ssh-agent</code> to manage the passphrase.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_copy_ssh_public_key_to_managed_hosts"><a class="anchor" href="#_step_2_copy_ssh_public_key_to_managed_hosts"></a>Step 2: Copy SSH Public Key to Managed Host(s)</h3>
<div class="paragraph">
<p>You need to copy your Control Node&#8217;s public SSH key (<code>~/.ssh/id_rsa.pub</code>) to the <code>authorized_keys</code> file in the <code>~/.ssh</code> directory of the user on each Managed Host that Ansible will connect as.</p>
</div>
<div class="paragraph">
<p>The easiest way to do this is using the <code>ssh-copy-id</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ssh-copy-id user@MANAGED_HOST_IP_OR_HOSTNAME</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Replace <code>user</code> with the actual username on the Managed Host that Ansible will connect as (this user must have <code>sudo</code> privileges).</p>
</li>
<li>
<p>Replace <code>MANAGED_HOST_IP_OR_HOSTNAME</code> with the Managed Host&#8217;s IP address or hostname.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You will be prompted to enter the Managed Host user&#8217;s password <strong>once</strong> during this process. <code>ssh-copy-id</code> handles creating the <code>~/.ssh</code> directory and setting correct permissions if they don&#8217;t exist.</p>
</div>
<div class="paragraph">
<div class="title">Alternative: Manual Key Copy</div>
<p>If <code>ssh-copy-id</code> is not available or you prefer to do it manually:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ cat ~/.ssh/id_rsa.pub | ssh user@MANAGED_HOST_IP_OR_HOSTNAME "mkdir -p ~/.ssh &amp;&amp; chmod 700 ~/.ssh &amp;&amp; cat &gt;&gt; ~/.ssh/authorized_keys &amp;&amp; chmod 600 ~/.ssh/authorized_keys"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will be prompted for the password of <code>user</code> on <code>MANAGED_HOST_IP_OR_HOSTNAME</code>.</p>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>After copying the key, try to SSH into the Managed Host from the Control Node. You should be able to connect without a password prompt (unless you set a passphrase for your SSH key, in which case you&#8217;d be prompted for that passphrase).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ssh user@MANAGED_HOST_IP_OR_HOSTNAME</code></pre>
</div>
</div>
<div class="paragraph">
<p>If successful, type <code>exit</code> to return to your Control Node.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ansible-inventory"><a class="anchor" href="#ansible-inventory"></a>Configuring the Ansible Inventory</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The inventory file is a crucial component in Ansible. It&#8217;s where you define your Managed Hosts, organize them into groups, and specify connection variables. By default, Ansible looks for <code>/etc/ansible/hosts</code>, but it&#8217;s best practice to create project-specific inventory files.</p>
</div>
<div class="sect2">
<h3 id="_step_1_create_an_inventory_file"><a class="anchor" href="#_step_1_create_an_inventory_file"></a>Step 1: Create an Inventory File</h3>
<div class="paragraph">
<p>Let&#8217;s create a dedicated directory for our Ansible lab files and then an inventory file within it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mkdir -p ~/ansible_lab
$ cd ~/ansible_lab
$ nano inventory.ini # or your preferred text editor like `vi`</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the following content to <code>inventory.ini</code>, replacing <code>MANAGED_HOST_IP_OR_HOSTNAME</code> with your actual managed host&#8217;s details and <code>user</code> with your SSH user:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ini hljs" data-lang="ini">[webservers]
managed_host_1 ansible_host=MANAGED_HOST_IP_OR_HOSTNAME ansible_user=user

[all:vars]
ansible_python_interpreter=/usr/bin/python3</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Explanation of Inventory Sections and Variables:</div>
<ul>
<li>
<p><code>[webservers]</code>: This defines a <strong>host group</strong> named <code>webservers</code>. You can group hosts logically (e.g., <code>databases</code>, <code>monitoring</code>, <code>dev_servers</code>).</p>
</li>
<li>
<p><code>managed_host_1</code>: This is an arbitrary <strong>alias</strong> (a friendly name) for your managed host within Ansible. You&#8217;ll use this alias or the group name when running commands.</p>
</li>
<li>
<p><code>ansible_host=MANAGED_HOST_IP_OR_HOSTNAME</code>: This is a <strong>host variable</strong> that tells Ansible the actual IP address or hostname to connect to.</p>
</li>
<li>
<p><code>ansible_user=user</code>: This is another <strong>host variable</strong> that specifies the username Ansible should use to connect via SSH to <code>managed_host_1</code>. This user <strong>must</strong> have <code>sudo</code> privileges on the Managed Host.</p>
</li>
<li>
<p><code>[all:vars]</code>: This is a special group that defines <strong>group variables</strong> which apply to <strong>all</strong> hosts in the inventory.</p>
</li>
<li>
<p><code>ansible_python_interpreter=/usr/bin/python3</code>: This explicitly tells Ansible which Python interpreter to use on the Managed Hosts. While Ansible is often good at discovering this, explicitly setting it can prevent potential issues, especially in environments with multiple Python versions.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test-connectivity"><a class="anchor" href="#test-connectivity"></a>Testing Connectivity with Ansible Ad-hoc Commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With the Control Node, Managed Host, SSH keys, and inventory all configured, it&#8217;s time to test if Ansible can successfully communicate with your Managed Host using an ad-hoc command. The <code>ping</code> module is perfect for this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ansible -i inventory.ini webservers -m ping</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Explanation of the command:</div>
<ul>
<li>
<p><code>ansible</code>: The main command-line tool for running ad-hoc commands.</p>
</li>
<li>
<p><code>-i inventory.ini</code>: Specifies to use your custom <code>inventory.ini</code> file. If you placed your hosts in <code>/etc/ansible/hosts</code>, you could omit this.</p>
</li>
<li>
<p><code>webservers</code>: This targets the <strong>host group</strong> named <code>webservers</code> as defined in your inventory file.</p>
</li>
<li>
<p><code>-m ping</code>: This specifies to use the <code>ping</code> <strong>module</strong>. The Ansible <code>ping</code> module is not an ICMP ping; instead, it tests if Ansible can connect to the managed host, successfully execute a small Python script, and receive a response.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Expected Output:</div>
<p>If everything is configured correctly, you should see output similar to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">managed_host_1 | SUCCESS =&gt; {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python3"
    },
    "changed": false,
    "ping": "pong"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>SUCCESS &#8658; {"ping": "pong"}</code> message indicates that your Control Node can successfully connect to and execute commands on your Managed Host. Congratulations!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="troubleshooting-connectivity"><a class="anchor" href="#troubleshooting-connectivity"></a>Troubleshooting Connectivity</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If <code>ansible -m ping</code> fails, review the following common issues:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>SSH Key Not Copied</strong>:</p>
</li>
<li>
<p><strong>Symptom</strong>: "Permission denied (publickey,password)."</p>
</li>
<li>
<p><strong>Solution</strong>: Double-check that your public SSH key from the Control Node (<code>~/.ssh/id_rsa.pub</code>) is correctly copied to <code>~/.ssh/authorized_keys</code> on the Managed Host for the user specified by <code>ansible_user</code>. Ensure file permissions are correct (<code>chmod 700 ~/.ssh</code> and <code>chmod 600 ~/.ssh/authorized_keys</code> on the Managed Host).</p>
</li>
<li>
<p><strong>Firewall Blocking SSH</strong>:</p>
</li>
<li>
<p><strong>Symptom</strong>: "Connection timed out" or "No route to host."</p>
</li>
<li>
<p><strong>Solution</strong>: Ensure the firewall on your Managed Host (e.g., <code>ufw</code> on Ubuntu, <code>firewalld</code> on CentOS/RHEL) is not blocking port 22 (SSH).</p>
</li>
<li>
<p><em>Ubuntu</em>: <code>sudo ufw allow ssh</code> or <code>sudo ufw allow 22/tcp</code></p>
</li>
<li>
<p><em>CentOS/RHEL</em>: <code>sudo firewall-cmd --permanent --add-service=ssh &amp;&amp; sudo firewall-cmd --reload</code></p>
</li>
<li>
<p><strong>Incorrect <code>ansible_user</code></strong>:</p>
</li>
<li>
<p><strong>Symptom</strong>: "Failed to connect to the host via SSH: Permission denied."</p>
</li>
<li>
<p><strong>Solution</strong>: Verify that the <code>ansible_user</code> specified in your <code>inventory.ini</code> exists on the Managed Host and has <code>sudo</code> privileges.</p>
</li>
<li>
<p><strong>Python Interpreter Issues</strong>:</p>
</li>
<li>
<p><strong>Symptom</strong>: "Error while attempting to run Python on the remote host."</p>
</li>
<li>
<p><strong>Solution</strong>: Ensure Python 3 is installed on the Managed Host and that the <code>ansible_python_interpreter</code> path in your <code>inventory.ini</code> is correct (e.g., <code>/usr/bin/python3</code>).</p>
</li>
<li>
<p><strong>SSH Connectivity Test</strong>:</p>
</li>
<li>
<p><strong>Symptom</strong>: <code>ssh user@MANAGED_HOST_IP_OR_HOSTNAME</code> from the Control Node also fails.</p>
</li>
<li>
<p><strong>Solution</strong>: If direct SSH fails, Ansible will also fail. Resolve the underlying SSH connectivity issue first (e.g., network connectivity, SSH server not running, incorrect credentials).</p>
</li>
<li>
<p><strong>Host Key Verification Failed</strong>:</p>
</li>
<li>
<p><strong>Symptom</strong>: "Host key verification failed."</p>
</li>
<li>
<p><strong>Solution</strong>: This usually means the Managed Host&#8217;s SSH key has changed or is incorrect in your Control Node&#8217;s <code>~/.ssh/known_hosts</code> file. You might need to remove the relevant entry from <code>~/.ssh/known_hosts</code> on the Control Node.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hands-on-lab-setup-ansible-environment"><a class="anchor" href="#hands-on-lab-setup-ansible-environment"></a>Hands-on Lab: Setting Up Your First Ansible Environment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This hands-on lab will guide you through the complete process of setting up a basic Ansible Control Node and one Managed Host using two Ubuntu Server 22.04 LTS virtual machines.</p>
</div>
<div class="sect2">
<h3 id="_lab_scenario"><a class="anchor" href="#_lab_scenario"></a>Lab Scenario</h3>
<div class="paragraph">
<p>You have provisioned two fresh Ubuntu Server 22.04 LTS VMs with the following assumed details:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Control Node VM</strong>: <code>ansible-control</code> with IP address <code>192.168.1.100</code></p>
</li>
<li>
<p><strong>Managed Host VM</strong>: <code>ansible-managed-01</code> with IP address <code>192.168.1.101</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Your goal is to:
1.  Install Ansible on the <code>ansible-control</code> VM.
2.  Prepare <code>ansible-managed-01</code> for Ansible management.
3.  Establish secure SSH key-based authentication from the Control Node to the Managed Host.
4.  Create an Ansible inventory file.
5.  Verify successful connectivity using Ansible&#8217;s <code>ping</code> module.</p>
</div>
</div>
<div class="sect2">
<h3 id="_step_by_step_instructions"><a class="anchor" href="#_step_by_step_instructions"></a>Step-by-Step Instructions</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Pre-lab Setup (outside Ansible configuration)</strong>:</p>
</li>
<li>
<p>Ensure both <code>ansible-control</code> and <code>ansible-managed-01</code> VMs are running.</p>
</li>
<li>
<p>Confirm you can SSH into both VMs independently using a password (e.g., <code>ssh ubuntu@192.168.1.100</code> and <code>ssh ubuntu@192.168.1.101</code>). The default user on Ubuntu is often <code>ubuntu</code>.</p>
</li>
<li>
<p>Verify both VMs have internet access.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_on_the_ansible_control_control_node_192_168_1_100"><a class="anchor" href="#_on_the_ansible_control_control_node_192_168_1_100"></a>On the <code>ansible-control</code> (Control Node - <code>192.168.1.100</code>)</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Install Ansible</strong>:
<code><code>bash
$ sudo apt update
$ sudo apt install software-properties-common -y
$ sudo add-apt-repository --yes --update ppa:ansible/ansible
$ sudo apt install ansible -y
</code></code></p>
</li>
<li>
<p><strong>Verify Ansible Installation</strong>:
<code><code>bash
$ ansible --version
</code></code>
Confirm that the Ansible version information is displayed.</p>
</li>
<li>
<p><strong>Generate SSH Key Pair</strong>:
We&#8217;ll generate a key without a passphrase for convenience in this lab.
<code><code>bash
$ ssh-keygen -t rsa -b 4096 -N "" -f ~/.ssh/id_rsa
</code></code>
This command generates a 4096-bit RSA key, saves it to the default location (<code>~/.ssh/id_rsa</code>), and uses an empty passphrase.</p>
</li>
<li>
<p><strong>Create Ansible Lab Directory</strong>:
<code><code>bash
$ mkdir -p ~/ansible_lab
$ cd ~/ansible_lab
</code></code></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_on_the_ansible_managed_01_managed_host_192_168_1_101"><a class="anchor" href="#_on_the_ansible_managed_01_managed_host_192_168_1_101"></a>On the <code>ansible-managed-01</code> (Managed Host - <code>192.168.1.101</code>)</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Ensure SSH Server is Installed and Running</strong>:
<code><code>bash
$ sudo apt update
$ sudo apt install openssh-server -y
$ sudo systemctl enable --now ssh
</code></code>
Verify it&#8217;s active: <code>sudo systemctl status ssh</code></p>
</li>
<li>
<p><strong>Ensure Python3 is Installed</strong>:
<code><code>bash
$ sudo apt update
$ sudo apt install python3 -y
</code></code>
Ubuntu Server typically has Python 3 pre-installed, but it&#8217;s good practice to ensure it&#8217;s there.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_back_on_the_ansible_control_control_node_192_168_1_100"><a class="anchor" href="#_back_on_the_ansible_control_control_node_192_168_1_100"></a>Back on the <code>ansible-control</code> (Control Node - <code>192.168.1.100</code>)</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Copy SSH Public Key to <code>ansible-managed-01</code></strong>:
We&#8217;ll use the <code>ubuntu</code> user on the managed host. You will be prompted for the <code>ubuntu</code> user&#8217;s password on <code>192.168.1.101</code> <strong>once</strong>.
<code><code>bash
$ ssh-copy-id ubuntu@192.168.1.101
</code></code>
After successful copying, test SSH connectivity without a password:
<code><code>bash
$ ssh ubuntu@192.168.1.101
</code></code>
You should connect directly without a password prompt. Type <code>exit</code> to return to your Control Node.</p>
</li>
<li>
<p><strong>Create Ansible Inventory File</strong>:
Ensure you are in the <code>~/ansible_lab</code> directory.
<code><code>bash
$ nano inventory.ini
</code></code>
Add the following content to the file:
```ini
[webservers]
ansible-managed-01 ansible_host=192.168.1.101 ansible_user=ubuntu</p>
<div class="literalblock">
<div class="content">
<pre>    [all:vars]
    ansible_python_interpreter=/usr/bin/python3
    ```
    Save the file and exit your text editor (e.g., Ctrl+X, Y, Enter for Nano).
3.  **Test Connectivity with Ansible**:
    Execute the `ansible ping` command, specifying your custom inventory file and targeting the `webservers` group:
    ```bash
    $ ansible -i inventory.ini webservers -m ping
    ```
    You should see output similar to this:
    ```json
    ansible-managed-01 | SUCCESS =&gt; {
        "ansible_facts": {
            "discovered_interpreter_python": "/usr/bin/python3"
        },
        "changed": false,
        "ping": "pong"
    }
    ```</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Congratulations! You have successfully set up your Ansible Control Node and a Managed Host, established secure communication, and verified connectivity. You are now ready to begin exploring Ansible&#8217;s powerful automation capabilities!</p>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="hands-on-lab.html">Hands-on Lab</a></span>
  <span class="next"><a href="executing-ad-hoc-commands-on-remote-hosts.html">Executing Ad-hoc Commands on Remote Hosts</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
